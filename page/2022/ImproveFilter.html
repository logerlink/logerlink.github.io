<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <link rel="stylesheet" type="text/css" href="../../css/base.css"></link>
        <meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
        <title>C# for 循环中如何更高效的筛选另一个集合的数据 - LogerLink .NET Blog</title>
        <meta name="description" content="c# for 循环中如何更高效的筛选另一个集合的数据,FirstOrDefault的效率提升,Where的效率提升">
        <link href='../../css/family.css' rel='stylesheet' type='text/css' />
        <script src="../../js/base.js" type="module"></script>
    </head>
    <body>
        <div class="container">
            <div class="col-left">
                <div class="wave"></div>
                <div class="category">
                </div>
            </div>
            <div class="col-right">
                <article>
                    <header>
                        <h1 class="title">
                            C# for 循环中如何更高效的筛选另一个集合的数据
                        </h1>
                        <div class="dateTime">
                            2022-05-11
                        </div>
                    </header>
                    <hr/>
                    <div class="content">
<div class='typora-export os-windows' >
<div id='write'  class=''><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span class="btn-toggle">&gt;</span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2"><a class="md-toc-inner" href="#说明">说明</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n5"><a class="md-toc-inner" href="#firstordefault基本用法">FirstOrDefault基本用法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n11"><a class="md-toc-inner" href="#where基本用法">Where基本用法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n15"><a class="md-toc-inner" href="#优化案例">优化案例</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n16"><a class="md-toc-inner" href="#数据准备">数据准备</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n21"><a class="md-toc-inner" href="#firstordefault-匹配查询单个数据">FirstOrDefault 匹配查询单个数据</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n33"><a class="md-toc-inner" href="#where匹配查询数据">Where匹配查询数据</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n45"><a class="md-toc-inner" href="#多字段分组题外话）">多字段分组（题外话）</a></span></p></div><h3><a name="说明" class="md-header-anchor"></a><span>说明</span></h3><p><span>本文介绍 FirstOrDefault、Where 基本用法，并介绍一下 </span><strong><span>for 循环中如何更高效的筛选另一个集合的数据</span></strong><span>，重点在后半部分</span></p><p><span>提前剧透，总的来说就是避免在for循环中使用 FirstOrDefault 或者 Where 去筛选B集合的数据，应该在 for 循环外部，对B集合进行分组筛选并装入字典 Dictionary 中，后续在 for 循环中使用相应的 Key 从字典中取值即可</span></p><h3><a name="firstordefault基本用法" class="md-header-anchor"></a><span>FirstOrDefault基本用法</span></h3><p><span>取集合中第一个符合条件的元素，若未指定条件则默认取第一个元素</span></p><p><span>若集合长度为零即没有数据或未找到一个符合条件的元素，则返回 Default(T) 即相应类型的默认值</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">void</span> <span class="cm-variable">FirstOrdefaultTest</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">string</span><span class="cm-operator">&gt;</span>() { <span class="cm-string">"a"</span>, <span class="cm-string">"b"</span>, <span class="cm-string">"c"</span>, <span class="cm-string">"d"</span>, <span class="cm-string">"e"</span>, <span class="cm-string">"f"</span>, <span class="cm-string">"g"</span>, <span class="cm-string">"good"</span>, <span class="cm-string">"boy"</span> };</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listFirst</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">FirstOrDefault</span>(); &nbsp;<span class="cm-comment">// a</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listFirst2</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">FirstOrDefault</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">StartsWith</span>(<span class="cm-string">'b'</span>)); &nbsp; <span class="cm-comment">// b</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listFirst3</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">FirstOrDefault</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">3</span>); &nbsp; &nbsp; &nbsp; <span class="cm-comment">// good</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listFirst4</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">FirstOrDefault</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">5</span>); &nbsp; &nbsp; &nbsp; <span class="cm-comment">//null 因为 default(string) == null</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//var listFirst5 = list.First(x =&gt; x.Length &gt;= 5); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  //未找到直接报错</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"listFirst={listFirst}，listFirst2={listFirst2}，listFirst3={listFirst3}，listFirst4={listFirst4 ?? "</span><span class="cm-atom">null</span><span class="cm-string">"}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listEmpty</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listEmptyFirst</span> <span class="cm-operator">=</span> <span class="cm-variable">listEmpty</span>.<span class="cm-variable">FirstOrDefault</span>(); &nbsp; &nbsp;<span class="cm-comment">// 0 因为 default(int) == 0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//var listEmptyFirst2 = listEmpty.First(); &nbsp; &nbsp; &nbsp; &nbsp;  //未找到直接报错</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"listEmptyFirst={listEmptyFirst}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"string默认值：{default(string) ?? "</span><span class="cm-atom">null</span><span class="cm-string">"}，Int默认值：{default(int)}，对象默认值：{default(object) ?? "</span><span class="cm-atom">null</span><span class="cm-string">"}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 460px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><p><span>执行结果如下：</span></p><p><img src="https://s2.loli.net/2022/05/11/ZBKYMgkqLhCiJ24.png" referrerpolicy="no-referrer" alt="image-20220511143755258"></p><h3><a name="where基本用法" class="md-header-anchor"></a><span>Where基本用法</span></h3><p><span>取集合中所有符合条件的元素</span></p><p><span>若集合长度为零即没有数据或未找到一个符合条件的元素，则返回空集合</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">void</span> <span class="cm-variable">WhereTest</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">string</span><span class="cm-operator">&gt;</span>() { <span class="cm-string">"a"</span>, <span class="cm-string">"b"</span>, <span class="cm-string">"c"</span>, <span class="cm-string">"d"</span>, <span class="cm-string">"e"</span>, <span class="cm-string">"f"</span>, <span class="cm-string">"g"</span>, <span class="cm-string">"good"</span>, <span class="cm-string">"boy"</span> };</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listWhere</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">Where</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">StartsWith</span>(<span class="cm-string">'b'</span>)).<span class="cm-variable">ToList</span>(); &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">// ["b", "boy"]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listWhere2</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">Where</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">3</span>).<span class="cm-variable">ToList</span>(); &nbsp; &nbsp; &nbsp; <span class="cm-comment">// ["good", "boy"]</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listWhere3</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">Where</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">5</span>).<span class="cm-variable">ToList</span>(); &nbsp; &nbsp; &nbsp; <span class="cm-comment">// []</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"listWhere={listWhere.Count}，listWhere2={listWhere2.Count}，listWhere3={listWhere3.Count}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listEmpty</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">listEmptyWhere</span> <span class="cm-operator">=</span> <span class="cm-variable">listEmpty</span>.<span class="cm-variable">Where</span>(<span class="cm-variable">x</span><span class="cm-operator">=&gt;</span><span class="cm-atom">true</span>); &nbsp; &nbsp;<span class="cm-comment">// []</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"listEmptyWhere={listEmptyWhere}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><h3><a name="优化案例" class="md-header-anchor"></a><span>优化案例</span></h3><h4><a name="数据准备" class="md-header-anchor"></a><span>数据准备</span></h4><p><span>新建 Student、Score 类</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Student</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">long</span> <span class="cm-variable">Id</span> { <span class="cm-keyword">get</span>; <span class="cm-keyword">set</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">string</span> <span class="cm-variable">Info</span> { <span class="cm-keyword">get</span>; <span class="cm-keyword">set</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">Score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">long</span> <span class="cm-variable">StudentId</span> { <span class="cm-keyword">get</span>; <span class="cm-keyword">set</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">string</span> <span class="cm-variable">Major</span> { <span class="cm-keyword">get</span>; <span class="cm-keyword">set</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">decimal</span> <span class="cm-variable">MajorValue</span> { <span class="cm-keyword">get</span>; <span class="cm-keyword">set</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><span>初始化Student、Score数据，并保存至桌面txt中</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">void</span> <span class="cm-variable">InitData</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">ids</span> <span class="cm-operator">=</span> <span class="cm-variable">Enumerable</span>.<span class="cm-variable">Range</span>(<span class="cm-number">100000</span>,<span class="cm-number">10000</span>);<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">//初始化1w条学生数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">major</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">string</span><span class="cm-operator">&gt;</span>() { <span class="cm-string">"Chinese"</span>, <span class="cm-string">"Math"</span>, <span class="cm-string">"English"</span>, <span class="cm-string">"Physics"</span>, <span class="cm-string">"History"</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">students</span> <span class="cm-operator">=</span> <span class="cm-variable">ids</span>.<span class="cm-variable">Select</span>(<span class="cm-variable">x</span><span class="cm-operator">=&gt;</span><span class="cm-keyword">new</span> <span class="cm-variable">Student</span>() { <span class="cm-variable">Id</span> <span class="cm-operator">=</span> <span class="cm-variable">x</span> });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scores</span> <span class="cm-operator">=</span> <span class="cm-variable">ids</span>.<span class="cm-variable">SelectMany</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">major</span>, (<span class="cm-variable">id</span>, <span class="cm-variable">major</span>) <span class="cm-operator">=&gt;</span> <span class="cm-keyword">new</span> <span class="cm-variable">Score</span>() { <span class="cm-variable">StudentId</span> <span class="cm-operator">=</span> <span class="cm-variable">id</span>,<span class="cm-variable">Major</span> <span class="cm-operator">=</span> <span class="cm-variable">major</span>,<span class="cm-variable">MajorValue</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">decimal</span>)<span class="cm-variable">Math</span>.<span class="cm-variable">Round</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Random</span>().<span class="cm-variable">NextDouble</span>() <span class="cm-operator">*</span> <span class="cm-number">100</span>,<span class="cm-number">1</span>) });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">studentStr</span> <span class="cm-operator">=</span> <span class="cm-variable">JsonConvert</span>.<span class="cm-variable">SerializeObject</span>(<span class="cm-variable">students</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scoreStr</span> <span class="cm-operator">=</span> <span class="cm-variable">JsonConvert</span>.<span class="cm-variable">SerializeObject</span>(<span class="cm-variable">scores</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">desktop</span> <span class="cm-operator">=</span> <span class="cm-variable">Environment</span>.<span class="cm-variable">GetFolderPath</span>(<span class="cm-variable">Environment</span>.<span class="cm-variable">SpecialFolder</span>.<span class="cm-variable">DesktopDirectory</span>) <span class="cm-operator">+</span><span class="cm-string">"\\"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">File</span>.<span class="cm-variable">WriteAllText</span>(<span class="cm-variable">desktop</span> <span class="cm-operator">+</span> <span class="cm-string">"student.txt"</span>, <span class="cm-variable">studentStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">File</span>.<span class="cm-variable">WriteAllText</span>(<span class="cm-variable">desktop</span> <span class="cm-operator">+</span> <span class="cm-string">"score.txt"</span>, <span class="cm-variable">scoreStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><h4><a name="firstordefault-匹配查询单个数据" class="md-header-anchor"></a><span>FirstOrDefault 匹配查询单个数据</span></h4><p><span>如将学生的信息显示为指定语文成绩</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">void</span> <span class="cm-variable">UpdateInfo</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">desktop</span> <span class="cm-operator">=</span> <span class="cm-variable">Environment</span>.<span class="cm-variable">GetFolderPath</span>(<span class="cm-variable">Environment</span>.<span class="cm-variable">SpecialFolder</span>.<span class="cm-variable">DesktopDirectory</span>) <span class="cm-operator">+</span> <span class="cm-string">"\\"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">studentStr</span> <span class="cm-operator">=</span><span class="cm-variable">File</span>.<span class="cm-variable">ReadAllText</span>(<span class="cm-variable">desktop</span> <span class="cm-operator">+</span> <span class="cm-string">"student.txt"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scoreStr</span> <span class="cm-operator">=</span> <span class="cm-variable">File</span>.<span class="cm-variable">ReadAllText</span>(<span class="cm-variable">desktop</span> <span class="cm-operator">+</span> <span class="cm-string">"score.txt"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">students</span> <span class="cm-operator">=</span> <span class="cm-variable">JsonConvert</span>.<span class="cm-variable">DeserializeObject</span><span class="cm-operator">&lt;</span><span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Student</span><span class="cm-operator">&gt;&gt;</span>(<span class="cm-variable">studentStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scores</span> <span class="cm-operator">=</span> <span class="cm-variable">JsonConvert</span>.<span class="cm-variable">DeserializeObject</span><span class="cm-operator">&lt;</span><span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Score</span><span class="cm-operator">&gt;&gt;</span>(<span class="cm-variable">scoreStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"本次处理学生数据：{students.Count}，成绩数据：{scores.Count}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">stopwatch</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Stopwatch</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#region</span> <span class="cm-variable">优化前</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Restart</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//将学生信息改成语文成绩</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">students</span>.<span class="cm-variable">ForEach</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Info</span> <span class="cm-operator">=</span> <span class="cm-string">"语文："</span> <span class="cm-operator">+</span> (<span class="cm-variable">scores</span>.<span class="cm-variable">FirstOrDefault</span>(<span class="cm-variable">y</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">y</span>.<span class="cm-variable">StudentId</span> <span class="cm-operator">==</span> <span class="cm-variable">x</span>.<span class="cm-variable">Id</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">y</span>.<span class="cm-variable">Major</span> <span class="cm-operator">==</span> <span class="cm-string">"Chinese"</span>)<span class="cm-operator">?</span>.<span class="cm-variable">MajorValue</span> <span class="cm-operator">??</span> <span class="cm-operator">-</span><span class="cm-number">1</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Stop</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"优化前耗时：{stopwatch.ElapsedMilliseconds}ms"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#endregion</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#region</span> <span class="cm-variable">优化后</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Restart</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scoreDic</span> <span class="cm-operator">=</span> <span class="cm-variable">scores</span>.<span class="cm-variable">Where</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Major</span> <span class="cm-operator">==</span> <span class="cm-string">"Chinese"</span>).<span class="cm-variable">GroupBy</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">StudentId</span>).<span class="cm-variable">ToDictionary</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Key</span>, <span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">FirstOrDefault</span>()<span class="cm-operator">?</span>.<span class="cm-variable">MajorValue</span> <span class="cm-operator">??</span> <span class="cm-operator">-</span><span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//将学生信息改成语文成绩</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">students</span>.<span class="cm-variable">ForEach</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Info</span> <span class="cm-operator">=</span> <span class="cm-string">"语文："</span> <span class="cm-operator">+</span> (<span class="cm-variable">scoreDic</span>.<span class="cm-variable">ContainsKey</span>(<span class="cm-variable">x</span>.<span class="cm-variable">Id</span>) <span class="cm-operator">?</span> <span class="cm-variable">scoreDic</span>[<span class="cm-variable">x</span>.<span class="cm-variable">Id</span>] : <span class="cm-operator">-</span><span class="cm-number">1</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Stop</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"优化后耗时：{stopwatch.ElapsedMilliseconds}ms"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#endregion</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 713px;"></div><div class="CodeMirror-gutters" style="display: none; height: 713px;"></div></div></div></pre><p><span>1.先执行优化前的代码，处理 1w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/fvAIXYreyCG3VhF.png" referrerpolicy="no-referrer" alt="image-20220511162318337"></p><p><span>2.先执行优化后的代码，处理 1w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/h6kQzGltK9p5LTq.png" referrerpolicy="no-referrer" alt="image-20220511162358000"></p><p><span>3.先执行优化前的代码，处理 5w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/wgTGaYCtrilWRZx.png" referrerpolicy="no-referrer" alt="image-20220511162923737"></p><p><span>4.先执行优化后的代码，处理 5w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/9GmQbsH5q1YXwVE.png" referrerpolicy="no-referrer" alt="image-20220511163325034"></p><p><span>执行了四次，我们可以看到这种方式对 FirstOrDefault 优化提升的效果是非常明显的，</span><strong><span>数据越多越受用</span></strong></p><h4><a name="where匹配查询数据" class="md-header-anchor"></a><span>Where匹配查询数据</span></h4><p><span>如将学生的信息显示为指定各科成绩，并显示总数</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">void</span> <span class="cm-variable">UpdateFullInfo</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">desktop</span> <span class="cm-operator">=</span> <span class="cm-variable">Environment</span>.<span class="cm-variable">GetFolderPath</span>(<span class="cm-variable">Environment</span>.<span class="cm-variable">SpecialFolder</span>.<span class="cm-variable">DesktopDirectory</span>) <span class="cm-operator">+</span> <span class="cm-string">"\\"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">studentStr</span> <span class="cm-operator">=</span> <span class="cm-variable">File</span>.<span class="cm-variable">ReadAllText</span>(<span class="cm-variable">desktop</span> <span class="cm-operator">+</span> <span class="cm-string">"student.txt"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scoreStr</span> <span class="cm-operator">=</span> <span class="cm-variable">File</span>.<span class="cm-variable">ReadAllText</span>(<span class="cm-variable">desktop</span> <span class="cm-operator">+</span> <span class="cm-string">"score.txt"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">students</span> <span class="cm-operator">=</span> <span class="cm-variable">JsonConvert</span>.<span class="cm-variable">DeserializeObject</span><span class="cm-operator">&lt;</span><span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Student</span><span class="cm-operator">&gt;&gt;</span>(<span class="cm-variable">studentStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scores</span> <span class="cm-operator">=</span> <span class="cm-variable">JsonConvert</span>.<span class="cm-variable">DeserializeObject</span><span class="cm-operator">&lt;</span><span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Score</span><span class="cm-operator">&gt;&gt;</span>(<span class="cm-variable">scoreStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"本次处理学生数据：{students.Count}，成绩数据：{scores.Count}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">stopwatch</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Stopwatch</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#region</span> <span class="cm-variable">优化前</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Restart</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//将学生信息改成语文成绩</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">students</span>.<span class="cm-variable">ForEach</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scoresTemp</span> <span class="cm-operator">=</span> <span class="cm-variable">scores</span>.<span class="cm-variable">Where</span>(<span class="cm-variable">y</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">y</span>.<span class="cm-variable">StudentId</span> <span class="cm-operator">==</span> <span class="cm-variable">x</span>.<span class="cm-variable">Id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">infos</span> <span class="cm-operator">=</span> <span class="cm-variable">scoresTemp</span>.<span class="cm-variable">Select</span>(<span class="cm-variable">y</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">$</span><span class="cm-string">"{y.Major}：{y.MajorValue}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span>.<span class="cm-variable">Info</span> <span class="cm-operator">=</span> <span class="cm-variable-3">string</span>.<span class="cm-variable">Join</span>(<span class="cm-string">"，"</span>, <span class="cm-variable">infos</span>) <span class="cm-operator">+</span> <span class="cm-variable">$</span><span class="cm-string">"，总分：{scoresTemp.Sum(y =&gt; y.MajorValue)}"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Stop</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"优化前耗时：{stopwatch.ElapsedMilliseconds}ms"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#endregion</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#region</span> <span class="cm-variable">优化后</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Restart</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">scoreDic</span> <span class="cm-operator">=</span> <span class="cm-variable">scores</span>.<span class="cm-variable">GroupBy</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">StudentId</span>).<span class="cm-variable">ToDictionary</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Key</span>, <span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">ToList</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//将学生信息改成语文成绩</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">students</span>.<span class="cm-variable">ForEach</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">scoreDic</span>.<span class="cm-variable">ContainsKey</span>(<span class="cm-variable">x</span>.<span class="cm-variable">Id</span>)) <span class="cm-variable">x</span>.<span class="cm-variable">Info</span> <span class="cm-operator">=</span> <span class="cm-variable-3">string</span>.<span class="cm-variable">Join</span>(<span class="cm-string">"，"</span>, <span class="cm-variable">scoreDic</span>[<span class="cm-variable">x</span>.<span class="cm-variable">Id</span>].<span class="cm-variable">Select</span>(<span class="cm-variable">y</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">$</span><span class="cm-string">"{y.Major}：{y.MajorValue}"</span>)) <span class="cm-operator">+</span> <span class="cm-variable">$</span><span class="cm-string">"，总分：{scoreDic[x.Id].Sum(y =&gt; y.MajorValue)}"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">x</span>.<span class="cm-variable">Info</span> <span class="cm-operator">=</span> <span class="cm-string">"缺考"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">stopwatch</span>.<span class="cm-variable">Stop</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Console</span>.<span class="cm-variable">WriteLine</span>(<span class="cm-variable">$</span><span class="cm-string">"优化后耗时：{stopwatch.ElapsedMilliseconds}ms"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#endregion</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 828px;"></div><div class="CodeMirror-gutters" style="display: none; height: 828px;"></div></div></div></pre><p><span>1.先执行优化前的代码，处理 1w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/TdRpjM1iWIfEhwD.png" referrerpolicy="no-referrer" alt="image-20220511170614272"></p><p><span>2.先执行优化后的代码，处理 1w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/OfUQ8Sz5G6jTMv1.png" referrerpolicy="no-referrer" alt="image-20220511170529343"></p><p><span>3.先执行优化前的代码，处理 5w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/WX56DY8gSQR9fhO.png" referrerpolicy="no-referrer" alt="image-20220511165406706"></p><p><span>4.先执行优化后的代码，处理 5w 条数据</span></p><p><img src="https://s2.loli.net/2022/05/11/NsYRlfMdH7vIn8a.png" referrerpolicy="no-referrer" alt="image-20220511170335906"></p><p><span>执行了四次，我们可以看到这种方式对 Where 优化提升的效果同样是非常明显的，</span><strong><span>数据越多越受用</span></strong></p><h4><a name="多字段分组题外话）" class="md-header-anchor"></a><span>多字段分组（题外话）</span></h4><p><span>如按照学生性别、年龄进行分组</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c#"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">students</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Student</span><span class="cm-operator">&gt;</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">students</span>.<span class="cm-variable">GroupBy</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-keyword">new</span> { <span class="cm-variable">x</span>.<span class="cm-variable">Age</span>, <span class="cm-variable">Sex</span> <span class="cm-operator">=</span> <span class="cm-variable">x</span>.<span class="cm-variable">Sex</span> <span class="cm-operator">??</span> <span class="cm-number">0</span> }).<span class="cm-variable">ToDictionary</span>(<span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">Key</span>, <span class="cm-variable">x</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">x</span>.<span class="cm-variable">ToList</span>());</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p>&nbsp;</p></div>


</div>
</div>
</article>
</div>
<div class="btn-toTop"></div>
</div>
</body>
</html>