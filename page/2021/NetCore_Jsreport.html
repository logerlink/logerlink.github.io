<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <link rel="stylesheet" type="text/css" href="../../css/base.css"></link>
        <meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
        <title>.Net Core在线预览打印PDF，JsReport的使用 - LogerLink .NET Blog</title>
        <meta name="description" content="CEFSharp如何打开多标签并管理多标签，CefSharp禁止弹出新窗体，在同一窗口打开链接，或者在新Tab页打开链接">
        <link href='../../css/family.css' rel='stylesheet' type='text/css' />
        <script src="../../js/base.js" type="module"></script>
    </head>
    <body>
        <div class="container">
            <div class="col-left">
                <div class="wave"></div>
                <div class="category">
                </div>
            </div>
            <div class="col-right">
                <article>
                    <header>
                        <h1 class="title">
                            .Net Core在线预览打印PDF，JsReport的使用
                        </h1>
                        <div class="dateTime">
                            2021-01-27
                        </div>
                    </header>
                    <hr/>
                    <div class="content">
<div class='typora-export os-windows' >
<div id='write'  class=''><p><span>说到在线预览并打印Pdf，Java的解决方案可谓层出不穷，尤以JasperReport为甚，再加上各大博客的资源分享，实现其功能更是易如反掌。再看回c#，资源寥寥无几，大多数是根据一个pdf模板，再生成一个新的pdf。</span></p><p><span>		</span><span>出去上网看了一下，终于找到解决方案：</span><a href='https://jsreport.net/'><span>jsreport</span></a></p><p><span>		</span><span>在线预览Demo：</span><a href='https://playground.jsreport.net/'><span>jsreport playground</span></a></p><p><span>		</span><span>社区论坛：</span><a href='https://forum.jsreport.net/'><span>jsreport forum</span></a></p><p><span>		</span><span>基础文档：</span><a href='https://jsreport.net/learn'><span>Learn jsreport</span></a></p><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/01/27/WYX8cICTt31uDJG.png" referrerpolicy="no-referrer" alt="image-20210127113926999"></p><p><span>	</span><span>三大特征：</span></p><ol start='' ><li><p><span>	</span><span>可支持生成多种文件类型（pdf, excel, docx, html, csv）</span></p></li><li><p><span>	</span><span>开源、跨平台（用于商业可购买）</span></p></li><li><p><span>	</span><span>html为模板（JasperReport以xml为模板，个人还是比较习惯用html的...）</span></p><p><span>基本介绍完之后，那么该如何在dotnet Core中使用呢？</span></p></li></ol><p><a href='https://jsreport.net/learn/dotnet'><span>jsreport: dotnet文档</span></a></p><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/01/27/roHa9VXEUm8zxfG.png" referrerpolicy="no-referrer" alt="image-20210127114617254"></p><p><span>Startup.cs的ConfigureServices加入：</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="c#" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 44px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#region</span> <span class="cm-variable">jsreport</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">services</span>.<span class="cm-variable">AddJsReport</span>(</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//为jsReport建一个临时文件，可以避免一些意外问题 要确保提供的文件路径存在</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">LocalReporting</span>().<span class="cm-variable">TempDirectory</span>(<span class="cm-variable">AppDomain</span>.<span class="cm-variable">CurrentDomain</span>.<span class="cm-variable">BaseDirectory</span> <span class="cm-operator">+</span> <span class="cm-string">"Files\\jsReportTemp"</span>) &nbsp; </span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">UseBinary</span>(<span class="cm-variable">JsReportBinary</span>.<span class="cm-variable">GetBinary</span>())</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//自定义端口  默认5488端口</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">Configure</span>((<span class="cm-variable">cfg</span>) <span class="cm-operator">=&gt;</span> { <span class="cm-variable">cfg</span>.<span class="cm-variable">HttpPort</span> <span class="cm-operator">=</span> <span class="cm-number">8008</span>; <span class="cm-keyword">return</span> <span class="cm-variable">cfg</span>; })</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//在启动一个jsreport程序前 结束正在运行的程序</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">KillRunningJsReportProcesses</span>()</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">AsUtility</span>()</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">Create</span>());</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">#endregion</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">//mvc支持</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">services</span>.<span class="cm-variable">AddControllersWithViews</span>();</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div></div></div></pre><p><span>Controller加一个Action</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="c#" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 44px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">/// &lt;summary&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// 打印标签</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;/summary&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;returns&gt;&lt;/returns&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">HttpGet</span>(<span class="cm-string">"label"</span>)]</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//jsReport支持</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">MiddlewareFilter</span>(<span class="cm-keyword">typeof</span>(<span class="cm-variable">JsReportPipeline</span>))]</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">IActionResult</span> <span class="cm-def">Label</span>()</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//jsReport支持</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">HttpContext</span>.<span class="cm-variable">JsReportFeature</span>().<span class="cm-variable">Recipe</span>(<span class="cm-variable">Recipe</span>.<span class="cm-variable">ChromePdf</span>); <span class="cm-comment">//Recipe.ChromePdf 即模板</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">View</span>(<span class="cm-variable">Init</span>());</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;summary&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// 生成ViewModel</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;/summary&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;returns&gt;&lt;/returns&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">LabelModel</span> <span class="cm-def">Init</span>()</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">labelModel</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LabelModel</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Fnsku</span> <span class="cm-operator">=</span> <span class="cm-string">"X003O97GHR"</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  };</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable-3">string</span>.<span class="cm-variable">IsNullOrWhiteSpace</span>(<span class="cm-variable">labelModel</span>.<span class="cm-variable">Fnsku</span>)) <span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">Exception</span>(<span class="cm-string">"Fnsku不可未空"</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">fileName</span> <span class="cm-operator">=</span> <span class="cm-string">"条形码_"</span> <span class="cm-operator">+</span> <span class="cm-variable">labelModel</span>.<span class="cm-variable">Fnsku</span> <span class="cm-operator">+</span> <span class="cm-variable-3">DateTime</span>.<span class="cm-variable">Now</span>.<span class="cm-variable">ToString</span>(<span class="cm-string">"yyMMddHHmmss"</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">path</span> <span class="cm-operator">=</span> <span class="cm-variable">AppDomain</span>.<span class="cm-variable">CurrentDomain</span>.<span class="cm-variable">BaseDirectory</span> <span class="cm-operator">+</span> <span class="cm-string">"Files\\pdfTemp\\"</span> <span class="cm-operator">+</span> <span class="cm-variable">fileName</span> <span class="cm-operator">+</span> <span class="cm-string">".jpg"</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Util</span>.<span class="cm-variable">CreateBarcode</span>(<span class="cm-variable">labelModel</span>.<span class="cm-variable">Fnsku</span>, <span class="cm-number">320</span>, <span class="cm-number">37</span>, <span class="cm-variable">path</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">labelModel</span>.<span class="cm-variable">Src</span> <span class="cm-operator">=</span> <span class="cm-variable">Util</span>.<span class="cm-variable">ImageToBase64</span>(<span class="cm-variable">path</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">title</span> <span class="cm-operator">=</span> <span class="cm-string">"Amazon Basics 48 Pack AA High-Performance Alkaline Batteries, 10-Year Shelf Life, Easy to Open Value Pack"</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable-3">string</span>.<span class="cm-variable">IsNullOrWhiteSpace</span>(<span class="cm-variable">title</span>) <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">title</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">18</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">title</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">35</span>) <span class="cm-variable">labelModel</span>.<span class="cm-variable">Title</span> <span class="cm-operator">=</span> <span class="cm-variable">title</span>.<span class="cm-variable">Substring</span>(<span class="cm-number">0</span>, <span class="cm-number">18</span>) <span class="cm-operator">+</span> <span class="cm-string">"...,"</span> <span class="cm-operator">+</span> <span class="cm-variable">title</span>[<span class="cm-variable">^35</span>..];</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable-3">string</span>.<span class="cm-variable">IsNullOrWhiteSpace</span>(<span class="cm-variable">title</span>) <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">title</span>.<span class="cm-variable">Length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">35</span>) <span class="cm-variable">labelModel</span>.<span class="cm-variable">Title</span> <span class="cm-operator">=</span> <span class="cm-variable">title</span>.<span class="cm-variable">Substring</span>(<span class="cm-number">0</span>, <span class="cm-number">18</span>) <span class="cm-operator">+</span> <span class="cm-string">"...,"</span> <span class="cm-operator">+</span> <span class="cm-variable">title</span>[<span class="cm-variable">^35</span>..];</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">labelModel</span>.<span class="cm-variable">Title</span> <span class="cm-operator">=</span> <span class="cm-variable">title</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//if (System.IO.File.Exists(path)) System.IO.File.Delete(path);</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">labelModel</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 920px;"></div></div></div></pre><p><span>对应的View：</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="html" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 44px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>23</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">@model JsReportTest.Models.LabelModel</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">style</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-qualifier">.text-center</span> {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-property">text-align</span>: <span class="cm-atom">center</span> <span class="cm-keyword">!important</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag">p</span> {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-property">margin-top</span>: <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-property">margin-bottom</span>: <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-property">font-size</span>: <span class="cm-number">0.85em</span> <span class="cm-keyword">!important</span>;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">style</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">body</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">style</span>=<span class="cm-string">"width:280px;"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">img</span> <span class="cm-attribute">style</span>=<span class="cm-string">"width:90%"</span> <span class="cm-attribute">src</span>=<span class="cm-string">"data:image/jgp;base64,@Model.Src"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"text-center"</span><span class="cm-tag cm-bracket">&gt;</span> @Model.Fnsku <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">style</span>=<span class="cm-string">"font-size:0.75em;"</span><span class="cm-tag cm-bracket">&gt;</span>@Model.Title<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">body</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 529px;"></div></div></div></pre><p><span>Action头部添加jsreport特性：[MiddlewareFilter(typeof(JsReportPipeline))]</span></p><p><span>返回视图前也要添加：HttpContext.JsReportFeature().Recipe(Recipe.ChromePdf);</span></p><p><span>View视图层就是pdf生成的模板，里面的数据可动态变化，只需传入对应的ViewModel即可。数据可动态变化，我们可以根据数据生成文档（pdf），而不需要每一份文档都存储到服务器里面，在预览合同、打印标签等场景下非常适用。</span></p><p><span>效果预览图：</span></p><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/01/27/hCdLioEpwxtObSG.png" referrerpolicy="no-referrer" alt="image-20210127141611552"></p><p><span>如何预览并在程序中保存文档：</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="c#" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c#"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 44px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>21</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">/// &lt;summary&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// 打印标签并在程序中保存</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;/summary&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">/// &lt;returns&gt;&lt;/returns&gt;</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">HttpGet</span>(<span class="cm-string">"labelAndSave"</span>)]</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//jsReport支持</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">MiddlewareFilter</span>(<span class="cm-keyword">typeof</span>(<span class="cm-variable">JsReportPipeline</span>))]</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">IActionResult</span> <span class="cm-def">LabelAndSave</span>()</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//jsReport支持</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">HttpContext</span>.<span class="cm-variable">JsReportFeature</span>().<span class="cm-variable">Recipe</span>(<span class="cm-variable">Recipe</span>.<span class="cm-variable">ChromePdf</span>).<span class="cm-variable">OnAfterRender</span>((<span class="cm-variable">res</span>)<span class="cm-operator">=&gt;</span> {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">fileName</span> <span class="cm-operator">=</span> <span class="cm-string">"条形码_"</span> <span class="cm-operator">+</span> <span class="cm-variable-3">DateTime</span>.<span class="cm-variable">Now</span>.<span class="cm-variable">ToString</span>(<span class="cm-string">"yyMMddHHmmss"</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">using</span> (<span class="cm-keyword">var</span> <span class="cm-def">file</span> <span class="cm-operator">=</span> <span class="cm-variable">System</span>.<span class="cm-variable">IO</span>.<span class="cm-variable">File</span>.<span class="cm-variable">Open</span>(<span class="cm-variable">fileName</span><span class="cm-operator">+</span><span class="cm-string">".pdf"</span>, <span class="cm-variable">FileMode</span>.<span class="cm-variable">Create</span>))</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">res</span>.<span class="cm-variable">Content</span>.<span class="cm-variable">CopyTo</span>(<span class="cm-variable">file</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">res</span>.<span class="cm-variable">Content</span>.<span class="cm-variable">Seek</span>(<span class="cm-number">0</span>, <span class="cm-variable">SeekOrigin</span>.<span class="cm-variable">Begin</span>);</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//todo 发邮件</span></span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  });</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">View</span>(<span class="cm-string">"Label"</span>,<span class="cm-variable">Init</span>());</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 483px;"></div></div></div></pre><p><span>适用于发送邮件时发送附件或将文档存储到服务器的场景</span></p><p><span>值得注意的是：如果你的程序（常出现在web api项目）使用ActionFilterAttribute来过滤返回的结果集，要将当前预览pdf的Action排除出去，不然会出现生成不了pdf或者pdf内容不正确的情况。</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 44px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>15</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  /// &lt;summary&gt;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  /// 打印标签并筛选结果集</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  /// &lt;/summary&gt;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  /// &lt;returns&gt;&lt;/returns&gt;</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [HttpGet("labelFilterTest")]</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  //jsReport支持</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [MiddlewareFilter(typeof(JsReportPipeline))]</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  //此处Filter作用不大，如果将此Filter用于修饰Class，效果会明显一点，此处不演示</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [TokenFilter] &nbsp; </span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  public IActionResult LabelFilterTest()</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  //jsReport支持</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  HttpContext.JsReportFeature().Recipe(Recipe.ChromePdf); //Recipe.ChromePdf 即模板</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  return View("Label",Init());</span></pre></div><div style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div></div></div></pre><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/01/27/6Uyg7n5zsOwDXlh.png" referrerpolicy="no-referrer" alt="image-20210127144750553"></p><p><span>改动后</span></p><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/01/27/SVrsCqjTtHuPWEk.png" referrerpolicy="no-referrer" alt="image-20210127145517534"></p><p><span>补充：</span></p><p><span>错误一：</span></p><p><span>2021-02-08 10:45:31.6101 | Error | Microsoft.AspNetCore.Server.IIS.Core.IISHttpServer | Connection ID &quot;17437937767379108040&quot;, Request ID &quot;800000c9-0002-f200-b63f-84710c7967bb&quot;: An unhandled exception was thrown by the application. jsreport.Local.JsReportBinaryException: Error rendering report: A critical error occurred while trying to execute the render command (2). An error occurred while trying to start daemonized process: An error has occurred when trying to initialize jsreport (1). caused by error (2):-&gt; stackError:    at onCriticalError (D:\snapshot\jsreport\node_modules\jsreport-cli\lib\commands\render.js:302:19)    at D:\snapshot\jsreport\node_modules\jsreport-cli\lib\commands\render.js:256:14caused by error (1):-&gt; </span><strong><mark><span>meta = {&quot;code&quot;:&quot;EACCES&quot;}</span></mark></strong><span>-&gt; stackError: An error has occurred when trying to initialize jsreport    at Object.</span><anonymous><span> (D:\snapshot\jsreport\node_modules\jsreport-cli\lib\keepAliveProcess.js:158:27)    at Object.listener (D:\snapshot\jsreport\node_modules\eventemitter2\lib\eventemitter2.js:251:10)    at Object.emit (D:\snapshot\jsreport\node_modules\eventemitter2\lib\eventemitter2.js:339:22)    at Object.</span><em><span>onData (D:\snapshot\jsreport\node_modules\nssocket\lib\nssocket.js:454:8)    at Lazy.</span><anonymous><span> (D:\snapshot\jsreport\node_modules\lazy\lazy.js:91:13)    at Lazy.</span><anonymous><span> (D:\snapshot\jsreport\node_modules\lazy\lazy.js:73:19)    at Lazy.emit (events.js:311:20)    at Lazy.</span><anonymous><span> (D:\snapshot\jsreport\node_modules\lazy\lazy.js:74:22)    at Lazy.emit (events.js:311:20)    at yieldTo (D:\snapshot\jsreport\node_modules\lazy\lazy.js:181:18)Remote Instance Error: Error:    at D:\snapshot\jsreport\node_modules\jsreport-cli\lib\instanceHandler.js:31:29Remote Instance Error: Error:    at Server.setupListenHandle [as _listen2] (net.js:1292:21)    at listenInCluster (net.js:1357:12)    at Server.listen (net.js:1445:7)    at D:\snapshot\jsreport\node_modules\jsreport-express\lib\reporter.express.js:23:12    at Promise.</span></em><span>execute (D:\snapshot\jsreport\node_modules\bluebird\js\release\debuggability.js:313:9)    at Promise._resolveFromExecutor (D:\snapshot\jsreport\node_modules\bluebird\js\release\promise.js:483:18)    at new Promise (D:\snapshot\jsreport\node_modules\bluebird\js\release\promise.js:79:10)    at startAsync (D:\snapshot\jsreport\node_modules\jsreport-express\lib\reporter.express.js:17:10)    at D:\snapshot\jsreport\node_modules\jsreport-express\lib\reporter.express.js:51:14    at Object.start (D:\snapshot\jsreport\node_modules\jsreport-express\lib\reporter.express.js:125:13)    at Object.</span><anonymous><span> (D:\snapshot\jsreport\node_modules\jsreport-express\lib\reporter.express.js:317:30)</span>
<span>   at jsreport.Local.Internal.LocalUtilityReportingService.RenderAsync(String requestString, CancellationToken ct)</span>
<span>   at jsreport.AspNetCore.JsReportMiddleware.Invoke(HttpContext context)</span>
<span>   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.</span><InvokeNextResourceFilter><span>g</span><strong><span>Awaited|24_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)</span>
<span>   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)</span>
<span>   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted)</span>
<span>   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.</span><InvokeFilterPipelineAsync><span>g</span></strong><span>Awaited|19_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)</span>
<span>   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.</span><InvokeAsync><span>g</span><strong><span>Logged|17_1(ResourceInvoker invoker)</span>
<span>   at Microsoft.AspNetCore.Routing.EndpointMiddleware.</span><Invoke><span>g</span></strong><span>AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)</span>
<span>   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)</span>
<span>   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)</span>
<span>   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)</span>
<span>   at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context)</span>
<span>   at Microsoft.AspNetCore.Session.SessionMiddleware.Invoke(HttpContext context)</span>
<span>   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)</span>
<span>   at StackExchange.Profiling.MiniProfilerMiddleware.Invoke(HttpContext context) in C:\projects\dotnet\src\MiniProfiler.AspNetCore\MiniProfilerMiddleware.cs:line 103</span>
<span>   at Microsoft.AspNetCore.Server.IIS.Core.IISHttpContextOfT</span><code>1.ProcessRequestAsync() 
 AsyncStateMachineBox</code><span>1.ExecutionContextCallback =&gt; </span><ProcessRequestAsync><span>d__2.MoveNext =&gt; IISHttpContext.ReportApplicationError </span></p><p>&nbsp;</p><p><span>解决方案：端口被占用，切换为可用端口（如：8018）即可，如果是发布到服务器上要在服务器管理后台上开放指定端口（如：8018）</span></p><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/02/08/kLzb8KEoF4WIRaQ.png" referrerpolicy="no-referrer" alt="image-20210208105526147"></p><p><img src="../../Image/loading.gif" data-src="https://i.loli.net/2021/02/08/CSnNuyJ4letHYVc.png" referrerpolicy="no-referrer" alt="image-20210208105120757"></p><p><span>查看源码：</span><a href='https://github.com/logerlink/NetCoreJsReportTest'><span>.Net Core在线预览打印PDF，JsReport的使用</span></a></p></div>

</div>
</div>
</article>
</div>
<div class="btn-toTop"></div>
</div>
</body>
</html>