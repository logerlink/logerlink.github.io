<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <link rel="stylesheet" type="text/css" href="../../css/base.css"></link>
        <meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
        <title>SQL Server数据库的连接操作整理与优化</title>
        <meta name="description" content="Server数据库的连接操作整理与优化————join内连接、left join左外连接、right join右外连接、full join全外连接">
        <link href='../../css/family.css' rel='stylesheet' type='text/css' />
        <script src="../../js/base.js" type="module"></script>
    </head>
    <body>
        <div class="container">
            <div class="col-left">
                <div class="wave"></div>
                <div class="category">
                </div>
            </div>
            <div class="col-right">
                <article>
                    <header>
                        <h1 class="title">
                            SQL Server数据库的连接操作整理与优化
                        </h1>
                        <div class="dateTime">
                            2024-03-21
                        </div>
                    </header>
                    <hr/>
                    <div class="content">
<div class='typora-export os-windows' >
<div id='write'  class=''><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2"><a class="md-toc-inner" href="#说明">说明</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n6"><a class="md-toc-inner" href="#连接方式">连接方式</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n7"><a class="md-toc-inner" href="#笛卡尔连接cartesian-join">笛卡尔连接(CARTESIAN JOIN)</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n15"><a class="md-toc-inner" href="#自然连接natural-join）">自然连接（NATURAL JOIN）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n29"><a class="md-toc-inner" href="#内连接inner-join）">内连接（INNER JOIN）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n34"><a class="md-toc-inner" href="#左外连接left-outer-join）">左外连接（LEFT OUTER JOIN）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n42"><a class="md-toc-inner" href="#右外连接right-outer-join）">右外连接（RIGHT OUTER JOIN）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n50"><a class="md-toc-inner" href="#全外连接full-outer-join）">全外连接（FULL OUTER JOIN）</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n57"><a class="md-toc-inner" href="#自连接">自连接</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n60"><a class="md-toc-inner" href="#join优化">Join优化</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n61"><a class="md-toc-inner" href="#join连接的索引">Join连接的索引</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n70"><a class="md-toc-inner" href="#join连接的顺序">join连接的顺序</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n77"><a class="md-toc-inner" href="#join连接的字段">join连接的字段</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n81"><a class="md-toc-inner" href="#优化总结">优化总结</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n99"><a class="md-toc-inner" href="#其他">其他</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n100"><a class="md-toc-inner" href="#join-连接的条件">join 连接的条件</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n119"><a class="md-toc-inner" href="#join连接执行顺序">join连接执行顺序</a></span></p></div><h3 id='说明'><span>说明</span></h3><p><span>简单整理了一下SqlServer数据库的连接操作。基于SqlServer，绝大部分内容也适用于其他数据库，大差不差，有特殊的地方也标出来了</span></p><p><span>准备数据可参考：</span><a href='https://logerlink.github.io/page/2024/MockSqlData.html'><span>借助 Mock.js 快速生成数据库虚拟数据 (logerlink.github.io)</span></a></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240321104439645.png" alt="image-20240321104439645" style="zoom:80%;" /></p><h3 id='连接方式'><span>连接方式</span></h3><h4 id='笛卡尔连接cartesian-join'><span>笛卡尔连接(CARTESIAN JOIN)</span></h4><p><a href='https://geek-docs.com/sql/sql-tutorials/sql-join-cartesian-join-self-join.html'><span>SQL – 连接(笛卡尔连接和自连接)|极客教程 (geek-docs.com)</span></a></p><p><span>笛卡尔连接又称为交叉链接。一个表的每一行与另一个表的每一行都有一个连接，支持多个表连接，连接查询结果集的行数是所有连接表行数的乘积（如三张表每张表有两行数据，那么笛卡尔连接后则会有(2 x 2 x 2=)8条数据）</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span><span class="cm-punctuation">,</span>p<span class="cm-variable-2">.ProductId</span> <span class="cm-keyword">from</span> test<span class="cm-variable-2">.dbo.TK_User</span> u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CROSS</span> <span class="cm-keyword">JOIN</span> test<span class="cm-variable-2">.dbo.TK_Address</span> a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CROSS</span> <span class="cm-keyword">JOIN</span> test<span class="cm-variable-2">.dbo.TK_Product</span> p</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'ADDR0000000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'ADDR0000000002'</span><span class="cm-bracket">)</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">-- 两条</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">and</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-bracket">)</span> <span class="cm-comment">-- 两条</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">and</span> p<span class="cm-variable-2">.ProductId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'PO00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'PO00000002'</span><span class="cm-bracket">)</span> <span class="cm-comment">-- 两条</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- 也可以写成</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span><span class="cm-punctuation">,</span>p<span class="cm-variable-2">.ProductId</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> test<span class="cm-variable-2">.dbo.TK_User</span> u<span class="cm-punctuation">,</span>test<span class="cm-variable-2">.dbo.TK_Address</span> a<span class="cm-punctuation">,</span>test<span class="cm-variable-2">.dbo.TK_Product</span> p</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124103312694.png" referrerpolicy="no-referrer" alt="image-20240124103312694"></p><p><span>如下图，我们可以看到笛卡尔连接使用条件查询时可以正常走索引，预期结果集行数 = 表1行数 * 表2行数 *表3行数...</span></p><p><span>多表连接时，结果集可能会非常庞大，建议加上限制条件(where、分页)不然很可能会超时</span></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240313145420017.png" referrerpolicy="no-referrer" alt="image-20240313145420017"></p><h4 id='自然连接natural-join）'><span>自然连接（NATURAL JOIN）</span></h4><p><span>进行自然连接操作的表必须要有相同列名的列，并以该字段作为匹配条件，自然连接的步骤是将第一张表的第一条记录和第二张表的每一条记录匹配，如果符合条件就将这两行组成一条记录，然后第一张表的第二条记录再和第二张表的每一条记录匹配，依次匹配，直到第一张表遍历完成</span></p><ol start='' ><li><span>找到两个或多个表之间</span><strong><span>具有相同列名的列</span></strong><span>。这些列被称为自然连接的条件列。</span></li><li><span>将具有相同值的条件列的行组合在一起，形成结果集。</span></li><li><span>结果集中只包含一次的列，即自然连接的条件列只出现一次。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- 在Mysql中可以直接使用 NATURAL JOIN</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> <span class="cm-operator">*</span> <span class="cm-keyword">FROM</span> TK_User u <span class="cm-keyword">NATURAL</span> <span class="cm-keyword">JOIN</span> TK_Address<span class="cm-punctuation">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- SQL Server没有NATURAL JOIN，可以借助inner join...on实现NATURAL JOIN效果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">INNER</span> <span class="cm-keyword">JOIN</span> TK_Address a <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">WHERE</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240321105143975.png" referrerpolicy="no-referrer" alt="image-20240321105143975"></p><p><span>如下图，我们可以看到自然连接使用条件查询时可以正常走索引，预期结果集行数 = 表1和表2匹配的行数</span></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240313151510640.png" referrerpolicy="no-referrer" alt="image-20240313151510640"></p><p><a href='https://geek-docs.com/sql/sql-tutorials/sql-join-set-1-inner-left-right-and-full-joins.html'><span>SQL – 连接(内连接，左连接，右连接和全连接)|极客教程 (geek-docs.com)</span></a></p><h4 id='内连接inner-join）'><span>内连接（INNER JOIN）</span></h4><p><span>内连接的结果和自然连接的结果是一样的。（在Mysql中两者）显示的属性不一样，内连接会将两张表的重复属性都分别列出来。</span></p><p><span>INNER JOIN 用于连接两个表，而 ON 子句用于指定了连接的条件。这样，只有匹配ON子句才会被连接起来形成结果集。内连接返回的结果集只包含匹配的行，如果两个表中的行在连接条件上没有匹配，那么这些行将被忽略。可以使用 INNER JOIN 来连接多个表</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">INNER</span> <span class="cm-keyword">JOIN</span> TK_Address a <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">WHERE</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- 也可以写成</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">INNER</span> <span class="cm-keyword">JOIN</span> TK_Address a <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">and</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124115133930.png" referrerpolicy="no-referrer" alt="image-20240124115133930"></p><h4 id='左外连接left-outer-join）'><span>左外连接（LEFT OUTER JOIN）</span></h4><p><span>左外连接，它会返回左表中的所有行，以及与右表中匹配的行。如果右表中没有匹配的行，则返回 NULL 值</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">LEFT</span> <span class="cm-keyword">JOIN</span> TK_Address a </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000003'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124151427170.png" referrerpolicy="no-referrer" alt="image-20240124151427170"></p><p><span>左外连接如果想根据左表或右表的某个条件进行过滤，应该</span><strong><span>使用where条件查询</span></strong><span>而不是直接在on后面追加条件</span></p><p><span>如下，使用where条件查询可以对查询结果根据UserId进行过滤，而在on后面追加条件则不会根据UserId进行过滤。因为左外连接会将左表的全部列出，从而导致查询结果不准确、查询效率不高（如果数据量大的话，会查询很久）等问题</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">LEFT</span> <span class="cm-keyword">JOIN</span> TK_Address a </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">and</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000003'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124154335948.png" referrerpolicy="no-referrer" alt="image-20240124154335948"></p><h4 id='右外连接right-outer-join）'><span>右外连接（RIGHT OUTER JOIN）</span></h4><p><span>右外连接，它会返回右表中的所有行，以及与左表中匹配的行。如果左表中没有匹配的行，则返回 NULL 值。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">RIGHT</span> <span class="cm-keyword">JOIN</span> TK_Address a </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> a<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU90000003'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124155241830.png" referrerpolicy="no-referrer" alt="image-20240124155241830"></p><p><span>右外连接如果想根据左表或右表的某个条件进行过滤，应该</span><strong><span>使用where条件查询</span></strong><span>而不是直接在on后面追加条件</span></p><p><span>如下，使用where条件查询可以对查询结果根据UserId进行过滤，而在on后面追加条件则不会根据UserId进行过滤。右外连接会将右表的数据全部列出，从而导致查询结果不准确、查询效率不高（如果数据量大的话，会查询很久）等问题</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">RIGHT</span> <span class="cm-keyword">JOIN</span> TK_Address a </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">and</span> a<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU90000003'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124160351018.png" referrerpolicy="no-referrer" alt="image-20240124160351018"></p><h4 id='全外连接full-outer-join）'><span>全外连接（FULL OUTER JOIN）</span></h4><p><span>全外连接，它会返回左表和右表中的所有行，并将它们进行合并。如果左表或右表中没有匹配的行，则对应的列将被填充为 NULL 值</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.City</span><span class="cm-punctuation">,</span>a<span class="cm-variable-2">.AddressId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">FULL</span> <span class="cm-keyword">JOIN</span> TK_Address a </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> a<span class="cm-variable-2">.UserId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000003'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU90000003'</span><span class="cm-bracket">)</span> <span class="cm-keyword">or</span> a<span class="cm-variable-2">.UserId</span> <span class="cm-keyword">in</span> <span class="cm-bracket">(</span><span class="cm-string">'UU00000001'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000002'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU00000003'</span><span class="cm-punctuation">,</span><span class="cm-string">'UU90000003'</span><span class="cm-bracket">)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124161234033.png" referrerpolicy="no-referrer" alt="image-20240124161234033"></p><p><span>全外连接如果想根据左表或右表的某个条件进行过滤，应该</span><strong><span>使用where条件查询</span></strong><span>而不是直接在on后面追加条件</span></p><p><span>如下，使用where条件查询可以对查询结果根据UserId进行过滤，而在on后面追加条件则不会根据UserId进行过滤。全外连接会将左表、右表的记录全部列出，从而导致查询结果不准确、查询效率不高（如果数据量大的话，会查询很久）等问题</span></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240124162147925.png" referrerpolicy="no-referrer" alt="image-20240124162147925"></p><h4 id='自连接'><span>自连接</span></h4><p><span>值得一提，实现自连接也是通过JOIN来实现。自连接在处理具有层次结构的数据时非常有用，但需要小心避免形成循环连接或性能问题</span><strong><span>（From AI.）</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- 查询权限及子权限</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> r1.<span class="cm-operator">*</span><span class="cm-punctuation">,</span>r2.<span class="cm-operator">*</span> <span class="cm-keyword">from</span> DataRight r1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">left</span> <span class="cm-keyword">join</span> DataRight r2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">on</span> r1<span class="cm-variable-2">.ParentId</span> <span class="cm-operator">=</span> r2<span class="cm-variable-2">.Id</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><h3 id='join优化'><span>Join优化</span></h3><h4 id='join连接的索引'><span>Join连接的索引</span></h4><p><span>内连接、外连接使用条件查询时都可以正常走索引。所以如果数据量大的话，join连接的优化方式通常是给</span><strong><span>where条件</span></strong><span>的字段加索引，或者给被驱动表（表2、表3）的</span><strong><span>连接字段</span></strong><span>加索引。</span></p><p><span>当被驱动表的连接字段没有建立索引时，被驱动表会使用最优的方案进行检索（有聚集索引则使用聚集索引，没有聚集索引则使用全表扫描）此时被驱动表读取的行数为驱动表的总数。</span></p><p><span>当我们给连接字段建立索引时，此时被驱动表会使用该索引进行检索，此时被驱动表读取的行数会小于驱动表的总数，这样就可以减少两张表的比较次数，从而提高查询效率。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-comment">-- drop index Index_TK_Order_UserId on dbo.TK_Order<span class="cm-tab" role="presentation" cm-text="	"> </span>-- 删除索引</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- create nonclustered index Index_TK_Order_UserId on dbo.TK_Order(UserId) &nbsp; -- 创建TK_Address表UserId列索引</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.OrderId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">INNER</span> <span class="cm-keyword">JOIN</span> TK_Order o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.UserId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> u<span class="cm-variable-2">.UserName</span> <span class="cm-keyword">like</span> <span class="cm-string">'F%'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240313160848800.png" referrerpolicy="no-referrer" alt="image-20240313160848800"></p><p><span>数据量太小，上图几乎没有看出区别，我们使用下面链接再比较试试</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-comment">-- drop index Index_TK_Order_UserId on dbo.TK_Order<span class="cm-tab" role="presentation" cm-text="	"> </span>-- 删除索引</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- create nonclustered index Index_TK_Order_UserId on dbo.TK_Order(UserId) &nbsp; -- 创建TK_Address表UserId列索引</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> top <span class="cm-number">10000</span> u<span class="cm-variable-2">.UserId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.UserName</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.OrderId</span> <span class="cm-keyword">FROM</span> TK_User u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">INNER</span> <span class="cm-keyword">JOIN</span> TK_Order o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.UserId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.UserId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> u<span class="cm-variable-2">.UserId</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240313162817593.png" referrerpolicy="no-referrer" alt="image-20240313162817593"></p><h4 id='join连接的顺序'><span>join连接的顺序</span></h4><p><span>数据表（条件查询后）的行数越少，尽量越靠前，用小表驱动大表。正常顺序：表1行数 &lt; 表2行数 &lt; 表3行数...</span></p><p><span>不知道是不是我看的是Mysql宝典的原因，在SqlServer中无论怎么重试，都达不到预期效果（小表越靠前查询效率越快）。不管怎么更换表顺序或者更换连接方式</span><strong><span>查询效率基本都是一致</span></strong><span>，如下图</span></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240319174017587.png" referrerpolicy="no-referrer" alt="image-20240319174017587"></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240321102641596.png" referrerpolicy="no-referrer" alt="image-20240321102641596"></p><p><span>百思不得其解，还是查一查吧。原来在SqlServer中使用连接查询，</span><strong><span>表的顺序不会影响查询效率</span></strong><span>。因为在执行过程中，SqlServer查询优化器总是能够基于统计信息(where查询后)来决定那张表作为驱动表——使用最小表作为物理联接运算符的外表</span></p><p><span>参考：</span><a href='https://www.cnblogs.com/woodytu/p/5050366.html'><span>Join的表顺序 - Woodytu - 博客园 (cnblogs.com)</span></a></p><h4 id='join连接的字段'><span>join连接的字段</span></h4><p><span>如果可以的话，尽可能的返回指定字段，字段越少效率越快。如下这两条Sql语句，同样的条件，查询效率相差了近两倍</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- 12s</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u.<span class="cm-operator">*</span><span class="cm-punctuation">,</span>o.<span class="cm-operator">*</span> <span class="cm-keyword">FROM</span> TK_Order u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inner</span> <span class="cm-keyword">JOIN</span> TK_OrderItem o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.OrderId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.OrderId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> <span class="cm-bracket">[</span>TotalCount<span class="cm-bracket">]</span> <span class="cm-operator">&lt;</span> <span class="cm-number">1000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">-- 7s</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.OrderId</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.TotalAmount</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.TotalCount</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.Amount</span><span class="cm-punctuation">,</span>o.<span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">FROM</span> TK_Order u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inner</span> <span class="cm-keyword">JOIN</span> TK_OrderItem o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.OrderId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.OrderId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> <span class="cm-bracket">[</span>TotalCount<span class="cm-bracket">]</span> <span class="cm-operator">&lt;</span> <span class="cm-number">1000</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240319175728379.png" referrerpolicy="no-referrer" alt="image-20240319175728379"></p><h4 id='优化总结'><span>优化总结</span></h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.TotalAmount</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.TotalCount</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.Amount</span><span class="cm-punctuation">,</span>o.<span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">FROM</span> TK_Order u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">left</span> <span class="cm-keyword">JOIN</span> TK_OrderItem o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.OrderId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.OrderId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> o.<span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-operator">&gt;</span> <span class="cm-number">80</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><span>如上代码，在SqlServer中join优化可以从这几方面入手：</span></p><ol start='' ><li><span>尽可能把查询条件放在Where中，给关联表的</span><strong><span>相关查询字段</span></strong><span>创建索引，使用索引查询——给表TK_OrderItem字段[Count]创建索引</span></li><li><span>给被驱动表的</span><strong><span>关联字段</span></strong><span>创建索引——给表TK_OrderItem字段OrderId创建索引</span></li><li><span>避免使用select *，尽可能的</span><strong><span>返回指定字段</span></strong><span>——SELECT u.TotalAmount,u.TotalCount...</span></li><li><span>建议关联查询</span><strong><span>连接不超过三张表</span></strong><span>（效率低、可读性差、难维护）——复杂逻辑一定要查询多张表的话可以利用代码来实现，而不是一味的join</span></li><li><span>业务不要求排序则</span><strong><span>尽量不排序</span></strong></li><li><span>增加join_buffer_size缓存区——仅针对Mysql</span></li><li><span>小表驱动大表——仅针对Mysql</span></li></ol><h3 id='其他'><span>其他</span></h3><h4 id='join-连接的条件'><span>join 连接的条件</span></h4><p><span>join 连接的条件应该怎么放？下面讲一下left join on 加条件和where加条件的区别</span></p><p><span>on和where都可以进行数据筛选，建议将查询条件放在Where中，on仅处理关联条件，其他条件由Where处理。</span></p><ul><li><strong><span>原因一</span></strong><span>：将条件放在Where中，可以适当</span><strong><span>利用关联表的索引</span></strong><span>提高查询效率</span></li></ul><p><span>一般情况下，on关联后会将关联后的数据放到一张临时表中，然后在临时表中执行Where查询。</span></p><p><span>在某些情况下，数据库优化器会选择在内存中进行连接操作，而不是创建临时表，此时会尝试利用关联表的索引来加速查询。这种方式可以避免额外的磁盘 I/O 操作和临时表的创建，从而提高查询效率。</span><strong><span>（From AI.）</span></strong></p><ul><li><strong><span>原因二：</span></strong><span>在外连接中，将条件放在on中可能会影响查询结果</span></li></ul><p><span>参考：</span><a href='https://blog.csdn.net/wqc19920906/article/details/79785424'><span>LEFT JOIN关联表中ON,WHERE后面跟条件的区别_left join on 加条件和where加条件的区别-CSDN博客</span></a></p><p><span>在inner join关联查询中，因为左右两张表一定会匹配数据，所以条件放在where和on结果都是一样的。</span></p><p><span>在左（右、全）外连接中不管on条件是否为真都会返回左（右边、左右两张表）的全部数据，此时数据可能不准确，如下图。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.TotalAmount</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.TotalCount</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.Amount</span><span class="cm-punctuation">,</span>o.<span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">FROM</span> TK_Order u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">left</span> <span class="cm-keyword">JOIN</span> TK_OrderItem o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.OrderId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.OrderId</span> <span class="cm-keyword">and</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-operator">&gt;</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">desc</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240320174011386.png" referrerpolicy="no-referrer" alt="image-20240320174011386"></p><p><span>原来left join 会返回左表全部数据，再根据on条件来匹配被驱动表的数据，如果条件匹配则填充数据，不匹配则保留null。相当于</span><strong><span>on仅仅用来作为匹配右表的条件，但是不能筛选数据表的数据</span></strong><span>，此时我们需要通过Where再次查询才能得到想要的结果，那为什么不直接把条件放在Where呢？如下图</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="sql"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="sql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51875px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.TotalAmount</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.TotalCount</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.Amount</span><span class="cm-punctuation">,</span>o.<span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">FROM</span> TK_Order u</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">left</span> <span class="cm-keyword">JOIN</span> TK_OrderItem o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.OrderId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.OrderId</span> <span class="cm-keyword">and</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-operator">&gt;</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-operator">&gt;</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">desc</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> u<span class="cm-variable-2">.TotalAmount</span><span class="cm-punctuation">,</span>u<span class="cm-variable-2">.TotalCount</span><span class="cm-punctuation">,</span>o<span class="cm-variable-2">.Amount</span><span class="cm-punctuation">,</span>o.<span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">FROM</span> TK_Order u</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">left</span> <span class="cm-keyword">JOIN</span> TK_OrderItem o <span class="cm-keyword">ON</span> u<span class="cm-variable-2">.OrderId</span> <span class="cm-operator">=</span> o<span class="cm-variable-2">.OrderId</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">where</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-operator">&gt;</span> <span class="cm-number">80</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">order</span> <span class="cm-keyword">by</span> <span class="cm-bracket">[</span><span class="cm-keyword">Count</span><span class="cm-bracket">]</span> <span class="cm-keyword">desc</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240320174452017.png" referrerpolicy="no-referrer" alt="image-20240320174452017"></p><h4 id='join连接执行顺序'><span>join连接执行顺序</span></h4><p><span>Sql查询语句的各个关键词执行的先后顺序（mysql版，其他数据库也大差不差）</span></p><p><span>From、On、Join、Where、Group by、With、Having、Select、Distinct、Order by、Limit（Top）</span></p><p><img src="https://gcore.jsdelivr.net/gh/logerlink/blogImg/typora-img/2024\image-20240320180032759.png" referrerpolicy="no-referrer" alt="image-20240320180032759"></p></div></div>


</div>
</div>
</article>
</div>
<div class="btn-toTop"></div>
</div>
</body>

</html>